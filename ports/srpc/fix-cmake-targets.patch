From 94d6d8ddd4d315a1fc86042547ed8cccc9bfce76 Mon Sep 17 00:00:00 2001
From: DengJun <dengjun@sogou-inc.com>
Date: Tue, 2 Feb 2021 13:46:00 +0800
Subject: [PATCH 1/2] fix cmake targets

---
 CMakeLists.txt       | 14 ++++++++++++++
 srpc-config.cmake.in |  2 ++
 2 files changed, 16 insertions(+)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 30ac1fd..ffd976e 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -120,6 +120,20 @@ install(
 	COMPONENT devel
 )
 
+
+install (
+	TARGETS ${CMAKE_PROJECT_NAME} EXPORT ${CMAKE_PROJECT_NAME}-targets
+	ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
+	LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
+	RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
+)
+
+install (
+	EXPORT ${CMAKE_PROJECT_NAME}-targets
+	FILE ${CMAKE_PROJECT_NAME}-targets.cmake
+	DESTINATION "${CMAKE_CONFIG_INSTALL_DIR}"
+)
+
 set(CPACK_RPM_SPEC_MORE_DEFINE "%define __spec_install_post /bin/true") # disable strip
 set(CPACK_GENERATOR "RPM")
 
diff --git a/srpc-config.cmake.in b/srpc-config.cmake.in
index 570331d..b453c89 100644
--- a/srpc-config.cmake.in
+++ b/srpc-config.cmake.in
@@ -5,5 +5,7 @@ set_and_check(SRPC_INCLUDE_DIR "@PACKAGE_CONFIG_INC_DIR@")
 set_and_check(SRPC_LIB_DIR "@PACKAGE_CONFIG_LIB_DIR@")
 set_and_check(SRPC_BIN_DIR "@PACKAGE_CONFIG_BIN_DIR@")
 
+include ("${CMAKE_CURRENT_LIST_DIR}/srpc-targets.cmake")
+
 check_required_components(srpc)
 
-- 
2.28.0.windows.1

